<!DOCTYPE html>
<html lang="bg">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>–§–∏—Ä–Ω ‚Äî –ü–∞–∑–∏—Ç–µ–ª—è—Ç –Ω–∞ –†–∏–ª–∞</title>

    <link
      href="https://fonts.googleapis.com/css2?family=El+Messiri:wght@400;600;700&family=Comfortaa:wght@300;400;700&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --text: #f3f8ff;
        --muted: #c5d4e4;
        --btn-bg: #295d86;
        --btn-bg2: #1e425f;
        --card-bg: rgba(0, 0, 0, 0.45);
        --max-width: 920px;
      }

      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: "Comfortaa", sans-serif;
        color: var(--text);
        background: #000;
      }

      /* Scenes stacked fullscreen */
      .scene {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.45s cubic-bezier(0.2, 0.9, 0.2, 1);
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
      }
      .scene.active {
        opacity: 1;
        pointer-events: auto;
      }

      /* background via CSS variable --bg-url (set by JS) */
      .scene::before {
        content: "";
        position: absolute;
        inset: 0;
        background-image: var(--bg-url);
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        z-index: 0; /* behind content */
        transform: translateZ(0); /* GPU */
      }
      .scene::after {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          180deg,
          rgba(0, 0, 0, 0.32),
          rgba(0, 0, 0, 0.78)
        );
        z-index: 1;
        pointer-events: none;
        backdrop-filter: blur(2px);
      }

      /* ensure card content is above pseudo layers */
      .card {
        position: relative;
        z-index: 10;
        width: 100%;
        max-width: var(--max-width);
        margin: auto;
        background: var(--card-bg);
        border-radius: 14px;
        padding: 36px 34px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
        text-align: center;
      }

      h1 {
        font-family: "El Messiri", sans-serif;
        font-size: 36px;
        margin: 0 0 12px 0;
        color: var(--text);
      }
      p {
        margin: 8px 0;
        font-size: 18px;
        line-height: 1.6;
        color: var(--text);
        text-align: justify;
      }

      .card p {
        max-width: 450px;
        margin-left: auto;
        margin-right: auto;
        text-align: justify;
      }

      #scene3 .card p {
        max-width: 300px;
        margin-left: auto;
        margin-right: auto;
        text-align: justify;
      }

      #scene4 .card p {
        max-width: 650px;
        margin-left: auto;
        margin-right: auto;
        text-align: justify;
      }

      .btn {
        padding: 12px 20px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.25);
        background: rgba(255, 255, 255, 0.08);
        color: #f2f8ff;
        font-weight: 600;
        cursor: pointer;
        transition: 0.2s ease;
      }

      .btn:hover {
        background: rgba(255, 255, 255, 0.14);
        border-color: rgba(255, 255, 255, 0.35);
      }

      .btn:active {
        background: rgba(255, 255, 255, 0.18);
      }

      #checkBtn {
        margin-top: 10px;
      }

      .btn.ghost {
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.18);
      }

      /* top controls */
      .top-controls {
        position: fixed;
        right: 16px;
        top: 12px;
        display: flex;
        gap: 8px;
        z-index: 30;
      }
      #musicToggle {
        background: rgba(0, 0, 0, 0.45);
        border: 1px solid rgba(255, 255, 255, 0.12);
        color: var(--text);
        padding: 8px 12px;
        border-radius: 10px;
        cursor: pointer;
        backdrop-filter: blur(4px);
      }

      .back-btn {
        position: fixed;
        left: 16px;
        top: 12px;
        z-index: 30;
        background: rgba(0, 0, 0, 0.45);
        color: var(--text);
        border: 1px solid rgba(255, 255, 255, 0.12);
        padding: 8px 12px;
        border-radius: 10px;
        cursor: pointer;
        backdrop-filter: blur(4px);
        display: none;
      }

      input[type="text"] {
        padding: 12px 14px;
        font-size: 16px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.25);
        background: rgba(0, 0, 0, 0.3);
        color: var(--text);
        width: 280px;
        text-align: center;
        margin-top: 10px;
      }
      .hint {
        margin-top: 14px;
        color: var(--muted);
        min-height: 28px;
      }

      .gifts {
        margin-top: 20px;
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 18px;
        justify-items: center;
        max-width: 850px;
        margin: auto;
      }

      .gift-card {
        width: 100%;
        max-width: 385px;
        background: rgba(255, 255, 255, 0.03);
        padding: 16px;
        border-radius: 12px;
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.02);
        text-align: left;
      }
      .gift-card h2 {
        font-family: "El Messiri";
        margin: 6px 0 10px 0;
        color: var(--text);
      }
      .footer-note {
        margin-top: 20px;
        color: var(--muted);
        font-size: 15px;
        text-align: center;
        padding: auto;
      }

      @media (max-width: 1100px) {
        .card {
          padding: 20px;
          margin: 14px;
        }
        h1 {
          font-size: 28px;
        }
        input[type="text"] {
          width: 220px;
        }
        .gifts {
          grid-template-columns: 1fr !important;
          gap: 14px;
          padding: 0 6px;
        }

        .gift-card {
          max-width: 100% !important;
          text-align: center;
          padding: 18px;
        }

        .gift-card h2 {
          font-size: 22px;
        }

        #scene4 .card p {
          max-width: 100% !important;
        }

        /* ---- –¢–£–ö –°–ê –¢–û–ß–ù–ò–¢–ï –†–ï–î–û–í–ï ---- */
        #scene4 {
          position: relative !important; /* FIX */
          overflow: visible !important; /* FIX */
          align-items: center !important; /* FIX */
          padding-top: 70px !important;
        }

        #scene4::before {
          background-size: cover !important;
          background-position: center center !important;
          background-repeat: no-repeat !important;

          height: auto !important; /* FIX */
          top: 0 !important; /* FIX */
        }

        #scene4 .card {
          padding: 26px 20px !important;
        }

        #scene4 .gifts {
          gap: 22px !important;
        }
      }

      /* –°–Ω–µ–∂–∏–Ω–∫–∏ */
      .snowflake {
        position: fixed;
        top: -10px;
        color: #fff;
        font-size: 10px;
        user-select: none;
        pointer-events: none;
        z-index: 1000;
        opacity: 0.5;
        animation-name: fall;
        z-index: 1;
        animation-timing-function: linear;
        animation-iteration-count: infinite;
      }

      @keyframes fall {
        0% {
          transform: translateY(-50vh) rotate(0deg);
        }
        100% {
          transform: translateY(100vh) rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div
      id="musicAsk"
      style="
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.75);
        backdrop-filter: blur(6px);
        z-index: 200;
        display: flex;
        align-items: center;
        justify-content: center;
      "
    >
      <div
        style="
          background: rgba(255, 255, 255, 0.08);
          padding: 28px 32px;
          border-radius: 14px;
          text-align: center;
          max-width: 320px;
        "
      >
        <p style="font-size: 18px; margin-bottom: 20px">
          –î–∞ –ø—É—Å–Ω–∞ –ª–∏ –º—É–∑–∏–∫–∞—Ç–∞?<br /><strong>–©–µ —Å—Ç–∞–Ω–µ –≤—ä–ª—à–µ–±–Ω–æ‚Ä¶</strong>
        </p>
        <button id="musicYesBtn" class="btn">–î–∞</button>
      </div>
    </div>

    <!-- top controls -->
    <div class="top-controls" aria-hidden="false">
      <button id="musicToggle">üîà –ú—É–∑–∏–∫–∞</button>
    </div>
    <button id="backBtn" class="back-btn" aria-hidden="true">‚Üê –ù–∞–∑–∞–¥</button>
    <audio id="music" src="audio/firn-theme.mp3" loop preload="auto"></audio>

    <!-- SCENE 1 -->
    <section id="scene1" class="scene" aria-hidden="true">
      <div class="card" role="main" aria-labelledby="s1title">
        <h1 id="s1title">–†–∏–ª–∞ —Ç–µ –ø–æ—Å—Ä–µ—â–∞</h1>
        <p>
          –†–∏–ª–∞ –ø–æ–º–Ω–∏ –Ω–µ—â–∞, –∫–æ–∏—Ç–æ —Ö–æ—Ä–∞—Ç–∞ –∑–∞–±—Ä–∞–≤—è—Ç.<br />–ò–º–µ–Ω–∞—Ç–∞ –Ω–∞ –ª–µ–¥–æ–≤–µ—Ç–µ.<br />–ü—É–∫–Ω–∞—Ç–∏–Ω–∏—Ç–µ,
          –ø–æ –∫–æ–∏—Ç–æ –∑–∏–º–∞—Ç–∞ –¥–∏—à–∞.<br />–ò –º–µ–Ω.
        </p>
        <p><strong>–ù–∞—Ä–∏—á–∞—Ç –º–µ –§–∏—Ä–Ω ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏—è—Ç –ª–µ–¥–µ–Ω –¥—É—Ö.</strong></p>
        <div><button class="btn" data-goto="2">–ü—Ä–æ–¥—ä–ª–∂–∏</button></div>
      </div>
    </section>

    <!-- SCENE 2 -->
    <section id="scene2" class="scene" aria-hidden="true">
      <div class="card" role="main" aria-labelledby="s2title">
        <h1 id="s2title">–ü—Ä–∏–∑–æ–≤–∞–≤–∞–Ω–µ—Ç–æ</h1>
        <p>
          –õ–µ–¥–Ω–∏—Ü–∏—Ç–µ –≤–µ—á–µ —Å–∞ —Ä—É—Ö–Ω–∞–ª–∏. –°–ª–µ–¥–∏—Ç–µ –∏–º ‚Äî –ø–æ—á—Ç–∏ –∑–∞–ª–∏—á–µ–Ω–∏.<br />–ê–ª–∞ –∏–º–∞
          –µ–¥–Ω–∞, –∫–æ—è—Ç–æ –æ—â–µ –≥–∏ —á—É–≤–∞‚Ä¶
        </p>
        <p>
          –ò–º–µ—Ç–æ —ù —Å–µ –ø—Ä–æ–º—ä–∫–≤–∞ –º–µ–∂–¥—É —Å–∫–∞–ª–∏—Ç–µ ‚Äî —à–µ–ø—Ç–∏ –ø–æ–¥ –∫–∞–º—ä–Ω–∏—Ç–µ –∫–∞—Ç–æ —Å—Ç–∞—Ä–∞,
          –∑–∞–±—Ä–∞–≤–µ–Ω–∞ —Å–∏–ª–∞:<br /><strong>–í–µ—Ä–æ–Ω–∏–∫–∞–∞–∞–∞–∞...</strong>
        </p>
        <p>
          –ù–µ –∑–Ω–∞–º –∫–æ—è –µ —Ç—è. –ù–æ –∑–Ω–∞–º, —á–µ —É—Å–µ—â–∞ –Ω–µ—â–∞, –∫–æ–∏—Ç–æ –¥—Ä—É–≥–∏—Ç–µ –Ω–µ –≤–∏–∂–¥–∞—Ç.
        </p>
        <div>
          <button class="btn" data-goto="3">–ê–∑ —Å—ä–º –í–µ—Ä–æ–Ω–∏–∫–∞–∞–∞–∞–∞</button>
        </div>
      </div>
    </section>

    <!-- SCENE 3 -->
    <section id="scene3" class="scene" aria-hidden="true">
      <div class="card" role="main" aria-labelledby="s3title">
        <h1 id="s3title">–®–µ–ø–æ—Ç—ä—Ç</h1>
        <p style="white-space: pre-line; font-size: 20px; margin-bottom: 18px">
          –î–∞–π –º–∏ –≥–ª–∞—Å ‚Äî –∏ —â–µ –∂–∏–≤–µ—è. –°–ø—Ä–∏ –¥—ä—Ö–∞ —Å–∏ ‚Äî —â–µ –∏–∑—Ç–ª–µ—è. –í–∏–Ω–∞–≥–∏ —Ç–∏
          –æ—Ç–≥–æ–≤–∞—Ä—è–º. –í —Ç–∏—à–∏–Ω–∞—Ç–∞ - –∑–∞–º—ä–ª—á–∞–≤–∞–º. –ö–æ–π —Å—ä–º –∞–∑?
        </p>

        <div>
          <input id="answer" type="text" placeholder="–í—ä–≤–µ–¥–∏ –æ—Ç–≥–æ–≤–æ—Ä–∞‚Ä¶" />
          <div><button class="btn" id="checkBtn">–ü—Ä–æ–≤–µ—Ä–∫–∞</button></div>
          <p id="hint" class="hint" aria-live="polite"></p>
        </div>
      </div>
    </section>

    <!-- SCENE 4 -->
    <section id="scene4" class="scene" aria-hidden="true">
      <div class="card" role="main" aria-labelledby="s4title">
        <h1 id="s4title">–ù—É–∂–Ω–æ—Å—Ç–∏ –Ω–∞ –§–∏—Ä–Ω</h1>
        <p>–ï—Ö–æ—Ç–æ –æ—Ç–≤—ä—Ä–Ω–∞. –ü—ä—Ç—è—Ç –µ –æ—Ç–∫—Ä–∏—Ç. –ê–∑ ‚Äî –§–∏—Ä–Ω, –º–æ–ª—è –∑–∞ –ø–æ–º–æ—â.</p>

        <div class="gifts" aria-label="–ø–æ–¥–∞—Ä—ä—Ü–∏">
          <div class="gift-card">
            <h2>–û–≥–Ω–µ–Ω –∫—Ä–∏—Å—Ç–∞–ª</h2>
            <p>
              –ë–µ–∑ –æ–≥—ä–Ω –ª–µ–¥—ä—Ç –Ω–µ –æ—Ü–µ–ª—è–≤–∞ ‚Äî –ø–∞—Ä–∞–¥–æ–∫—Å, –∫–æ–π—Ç–æ —Å–∞–º–æ –ª–µ–¥–µ–Ω –¥—É—Ö
              –ø–æ–∑–Ω–∞–≤–∞. –ù—É–∂–µ–Ω –º–∏ –µ –º–∞–ª—ä–∫ –∏–∑—Ç–æ—á–Ω–∏–∫ –Ω–∞ —Ç–æ–ø–ª–∏–Ω–∞: –ø–æ—Ä—Ü–µ–ª–∞–Ω–æ–≤ –∏–ª–∏
              –º–µ—Ç–∞–ª–µ–Ω —á–∞–π–Ω–∏–∫, –±–µ–∑ –µ–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ. –ù–µ –∏—Å–∫–∞–º–µ —Å –≤–æ–¥–∞ –∏ —Ç–æ–∫ –¥–∞ —Å—Ç–∞–Ω–µ
              –±—É–º-–±—É–º.
            </p>
          </div>

          <div class="gift-card">
            <h2>–°–Ω–µ–∂–Ω–∞ —Å–∏–ª–∞</h2>
            <p>
              –ó–∞ –¥–∞ –≤—ä—Ä–Ω–∞ –ª–µ–¥–Ω–∏—Ü–∏—Ç–µ, —Ç—Ä—è–±–≤–∞ —Å–∏–ª–∞ ‚Äî –Ω–µ —Ä–∞–∑—Ä—É—à–∏—Ç–µ–ª–Ω–∞, –∞ —Ç—ä—Ä–ø–µ–ª–∏–≤–∞.
              –°–∏–ª–∞, –∫–æ—è—Ç–æ —Å–µ –Ω–∞—Ç—Ä—É–ø–≤–∞ –∫–∞—Ç–æ —Å–Ω—è–≥: –ø–ª–∞—Å—Ç —Å–ª–µ–¥ –ø–ª–∞—Å—Ç, –¥–µ–Ω —Å–ª–µ–¥ –¥–µ–Ω.
              –ù–∞–ø—Ä–∏–º–µ—Ä —Å –¥–æ–º–∞—à–Ω–æ –æ–±–æ—Ä—É–¥–≤–∞–Ω–µ –∑–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏.
            </p>
          </div>

          <div class="gift-card">
            <h2>–†–∞–∑—É–º –≤ –∫—É—Ç–∏—è</h2>
            <p>
              –£–º–∞ –∏ —Ö–ª–∞–¥–Ω–æ–∫—Ä—ä–≤–∏–µ—Ç–æ —Ç—É–∫ —Å–µ –∏–∑–ø–∏—Ç–≤–∞—Ç –≤—Å–µ–∫–∏–¥–Ω–µ–≤–Ω–æ ‚Äî –≤—Å–∏—á–∫–æ, –∫–æ–µ—Ç–æ
              –µ–¥–∏–Ω –¥—É—Ö —Ç—Ä—è–±–≤–∞ –¥–∞ –≤–ª–∞–¥–µ–µ. –ó–Ω–∞–º, —á–µ —Å—ä—Å —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏/–∫–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–∏
              –Ω–∞—Å—Ç–æ–ª–Ω–∏ –∏–≥—Ä–∏ —â–µ —Å–µ —Å–ø—Ä–∞–≤—è.
            </p>
          </div>

          <div class="gift-card">
            <h2>–£–º–Ω–∏ –ª–µ–¥–µ–Ω–∏ –º–∞—à–∏–Ω–∏</h2>
            <p>
              –°—Ç—É–¥—ä—Ç —Å—Ç—Ä–æ–∏ –∞—Ä–º–∏–∏ –Ω–µ –æ—Ç –ø–ª—ä—Ç, –∞ –æ—Ç –º–µ—Ç–∞–ª –∏ —Å–≤–µ—Ç–ª–∏–Ω–∞. –ó–∞ –¥–∞ –≤—ä—Ä–Ω–µ–º
              –ª–µ–¥–∞, —â–µ —Å–∞ –Ω—É–∂–Ω–∏ –º–∞—à–∏–Ω–∏ ‚Äî —É–º–æ–≤–µ –æ—Ç –∫–æ–¥ –∏ –∂–∏—Ü–∞. –¢—Ä—è–±–≤–∞—Ç –º–∏ —á–∞—Å—Ç–∏
              –∑–∞ —Ä–æ–±–æ—Ç–∏–∫–∞ ‚Äî ESP, —Å–µ–Ω–∑–æ—Ä–∏, –º–µ—Ö–∞–Ω–∏—á–Ω–∏ –µ–ª–µ–º–µ–Ω—Ç–∏.
            </p>
          </div>
        </div>
        <div style="margin-top: 20px">
          <button class="btn" data-goto="5">–ü—Ä–æ–¥—ä–ª–∂–∏</button>
        </div>
      </div>
    </section>

    <!-- SCENE 5 -->
    <section id="scene5" class="scene" aria-hidden="true">
      <div class="card" role="main" aria-labelledby="s5title">
        <h1 id="s5title">–ì–æ—Ç–æ–≤/–∞ –ª–∏ —Å–∏?</h1>
        <div><button class="btn" data-goto="6">–ü—Ä–æ–¥—ä–ª–∂–∏</button></div>
      </div>
    </section>

    <!-- SCENE 6: Countdown -->
    <section id="scene6" class="scene" aria-hidden="true">
      <div class="card" role="main" aria-labelledby="s6title">
        <h1 id="s6title">–°—Ç–∞—Ä—Ç —Å–ª–µ–¥:</h1>
        <p
          id="countdown"
          style="
            font-size: 48px;
            margin-top: 20px;
            margin: auto;
            text-align: center;
          "
        >
          3
        </p>
      </div>
    </section>

    <script>
      /* ---------- CONFIG: background image paths (case-sensitive) ---------- */
      const BG = {
        scene1: "img/rila1.png",
        scene2: "img/rila2.jpg",
        scene3: "img/echo.png",
        scene4: "img/frost.png",
      };

      /* ---------- helper: set CSS variable --bg-url on each scene element ---------- */
      function setSceneBackgrounds() {
        Object.keys(BG).forEach((id) => {
          const el = document.getElementById(id);
          if (!el) {
            console.warn("Missing scene element", id);
            return;
          }
          // set --bg-url to a CSS url() value
          el.style.setProperty("--bg-url", `url("${BG[id]}")`);
        });
      }

      /* ---------- debug preloader: verifies images exist & logs ---------- */
      function preloadAndLog() {
        Object.values(BG).forEach((src) => {
          const img = new Image();
          img.onload = () => console.log("bg loaded", src);
          img.onerror = () => console.error("bg failed to load (404?):", src);
          img.src = src;
        });
      }

      /* ---------- scene stack logic ---------- */
      const scenes = [
        "scene1",
        "scene2",
        "scene3",
        "scene4",
        "scene5",
        "scene6",
      ];
      let currentIndex = 0;

      function showScene(i) {
        if (i < 0) i = 0;
        if (i >= scenes.length) i = scenes.length - 1;
        currentIndex = i;
        scenes.forEach((id, idx) => {
          const el = document.getElementById(id);
          if (!el) return;
          if (idx === i) {
            el.classList.add("active");
            el.setAttribute("aria-hidden", "false");
          } else {
            el.classList.remove("active");
            el.setAttribute("aria-hidden", "true");
          }
        });
        document.getElementById("backBtn").style.display =
          i === 0 ? "none" : "block";
        window.scrollTo(0, 0);
        console.log("Active scene:", scenes[i]);
      }

      /* ---------- delegation for any element with data-goto ---------- */
      document.addEventListener("click", (ev) => {
        const t = ev.target.closest("[data-goto]");
        if (t) {
          const goto = Number(t.getAttribute("data-goto"));
          if (!isNaN(goto)) showScene(goto - 1);
        }
      });

      /* ---------- riddle logic ---------- */
      const accepted = new Set(["echo", "–µ—Ö–æ", "ohce", "–æ—Ö–µ", "–æ—Ö–æ"]);
      let attempts = 0;
      document.getElementById("checkBtn").addEventListener("click", () => {
        const val = document
          .getElementById("answer")
          .value.trim()
          .toLowerCase();
        const hint = document.getElementById("hint");
        attempts++;
        if (accepted.has(val)) {
          hint.style.color = "#b6fcd2";
          hint.textContent = "–ü—Ä–∞–≤–∏–ª–Ω–æ.";
          setTimeout(() => showScene(3), 700);
          return;
        }
        hint.style.color = "#ffb3b3";
        if (attempts === 1) hint.textContent = "–û–ø–∏—Ç–∞–π –ø–∞–∫‚Ä¶";
        else if (attempts === 2)
          hint.textContent = "–¢–æ–≤–∞ –µ –∑–≤—É–∫, –∫–æ–π—Ç–æ —Å–µ –≤—Ä—ä—â–∞.";
        else if (attempts === 3)
          hint.textContent = "–í–∏–Ω–∞–≥–∏ —Ç–∏ –æ—Ç–≥–æ–≤–∞—Ä—è. –û—Å–≤–µ–Ω –∫–æ–≥–∞—Ç–æ –º—ä–ª—á–∏—à.";
        else if (attempts >= 4)
          hint.innerHTML =
            '<div style="text-align:center;">–ê–∫–æ —Å–µ –ø—Ä–µ–¥–∞–≤–∞—à:<br><button class="btn ghost" data-goto="4" style="margin-top:6px;">–†–∞–∑–∫—Ä–∏–π –ø—ä—Ç—è</button></div>';
      });

      /* ---------- music toggle ---------- */
      const music = document.getElementById("music");
      const musicToggle = document.getElementById("musicToggle");
      let musicStarted = false;
      musicToggle.addEventListener("click", () => {
        if (!musicStarted) {
          music.play().catch(() => {}); // blocked sometimes
          musicStarted = true;
          musicToggle.textContent = "üîä –ü–∞—É–∑–∞";
          return;
        }
        if (music.paused) {
          music.play();
          musicToggle.textContent = "üîä –ü–∞—É–∑–∞";
        } else {
          music.pause();
          musicToggle.textContent = "üîà –ú—É–∑–∏–∫–∞";
        }
      });

      /* ---------- init ---------- */
      document.addEventListener("DOMContentLoaded", () => {
        setSceneBackgrounds();
        preloadAndLog();
        // show first scene (safe)
        showScene(0);
        /* ----- BACK BUTTON ----- */
        document.getElementById("backBtn").addEventListener("click", () => {
          showScene(currentIndex - 1);
        });
      });

      /* ----- MUSIC START MODAL ----- */
      document.getElementById("musicYesBtn").addEventListener("click", () => {
        const ask = document.getElementById("musicAsk");
        ask.style.opacity = "0";
        ask.style.pointerEvents = "none";
        setTimeout(() => ask.remove(), 400);

        // start music
        music.play().catch(() => {});
        musicStarted = true;
        musicToggle.textContent = "üîä –ü–∞—É–∑–∞";
      });

      function createSnowflakes(count = 50) {
        for (let i = 0; i < count; i++) {
          const flake = document.createElement("div");
          flake.className = "snowflake";
          flake.textContent = "‚ùÑ"; // —Å–∏–º–≤–æ–ª –Ω–∞ —Å–Ω–µ–∂–∏–Ω–∫–∞
          flake.style.left = Math.random() * window.innerWidth + "px";
          flake.style.fontSize = Math.random() * 16 + 8 + "px";
          flake.style.animationDuration = Math.random() * 5 + 5 + "s";
          flake.style.opacity = Math.random();
          document.body.appendChild(flake);
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        createSnowflakes(60);
      });

      // Countdown –ª–æ–≥–∏–∫–∞
      function startCountdown() {
        let count = 3;
        const countdownEl = document.getElementById("countdown");
        const interval = setInterval(() => {
          count--;
          if (count > 0) {
            countdownEl.textContent = count;
          } else {
            clearInterval(interval);
            countdownEl.textContent = "–ß–∞–æ!";
            // –ó–∞—Ç–≤–∞—Ä—è —Å–∞–π—Ç–∞/–ø—Ä–µ–Ω–∞—Å–æ—á–≤–∞
            setTimeout(() => {
              window.close(); // –†–∞–±–æ—Ç–∏ —Å–∞–º–æ –∞–∫–æ –µ –æ—Ç–≤–æ—Ä–µ–Ω —á—Ä–µ–∑ JS
              // –ê–∫–æ –Ω–µ —Å–µ –∑–∞—Ç–≤–æ—Ä–∏, –º–æ–∂–µ –¥–∞ –ø—Ä–µ–Ω–∞—Å–æ—á–∏
              // window.location.href = "about:blank";
            }, 800);
          }
        }, 1000);
      }

      // –î–æ–±–∞–≤–∏ listener –∑–∞ —Å—Ü–µ–Ω–∞6
      document.addEventListener("click", (ev) => {
        const t = ev.target.closest("[data-goto]");
        if (t) {
          const goto = Number(t.getAttribute("data-goto"));
          if (!isNaN(goto)) {
            showScene(goto - 1);
            if (goto - 1 === scenes.indexOf("scene6")) startCountdown();
          }
        }
      });
    </script>
  </body>
</html>
